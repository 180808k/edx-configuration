---
- name: Add the jenkins user to the edx group
  user: name=jenkins append=yes groups="edx"

- name: Install Jenkins
  shell: wget -q -O - http://pkg.jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add -

- name: Install Jenkins 2
  shell: sh -c 'echo deb http://pkg.jenkins-ci.org/debian binary/ > /etc/apt/sources.list.d/jenkins.list'

- name: Install Jenkins 3
  shell: apt-get update

- name: install jenkins 4
  apt: pkg=jenkins state=present

- name: Make plugins directory
  sudo_user: jenkins
  shell: mkdir -p {{ jenkins_home }}/plugins

- name: Install Jenkins plugins
  sudo_user: jenkins
  get_url: url=http://updates.jenkins-ci.org/latest/${item}
           dest={{ jenkins_home }}/plugins/${item}
  with_items:
    - ant.hpi
    - backup.hpi
    - build-name-setter.hpi
    - build-timeout.hpi
    - cobertura.hpi
    - credentials.hpi
    - cvs.hpi
    - dashboard-view.hpi
    - external-monitor-job.hpi
    - ghprb.hpi
    - git.hpi
    - github.hpi
    - git-client.hpi
    - github-api.hpi
    - github-oauth.hpi
    - git-notes.hpi
    - htmlpublisher.hpi
    - javadoc.hpi
    - jobConfigHistory.hpi
    - ldap.hpi
    - mailer.hpi
    # - maven-plugin.hpi
    - mercurial.hpi
    - nested-view.hpi
    - next-build-number.hpi
    - notification.hpi
    - pam-auth.hpi
    - parameterized-trigger.hpi
    - postbuild-task.hpi
    - rbenv.hpi
    - ruby-runtime.hpi
    - shiningpanda.hpi
    - ssh-credentials.hpi
    - ssh-slaves.hpi
    - subversion.hpi
    - thinBackup.hpi
    # - timestamper.hpi
    - tmpcleaner.hpi
    - token-macro.hpi
    - translation.hpi
    - violations.hpi
  notify:
    - restart Jenkins
